<%= render partial: "assignments/coaches_feedback" %>

<% if @current_user.is_coach? %>
  <h1><a href="/coaches">Coaching Dashboard</a> &raquo; <a href="/coaches?student_id=<%=@assignment.user_id %>"><%= @assignment.user.name %></a></h1>
<% end %>

<div class="assignment-task-pane">
  <div class="assignment-summary">
    <section>
      <h2><%= @assignment.assignment_definition.title %>
        <% if @assignment.assignment_definition.led_by != nil %>
          <span class="session-type">(<%=@assignment.assignment_definition.led_by.capitalize%> Led)</span>
        <% end %>
      </h2>

    </section>
    <%
      wrapper_class = ''
      if @assignment.submittable?
        wrapper_class = 'assignment-submittable'
      elsif @assignment.in_progress?
        wrapper_class = 'assignment-in-progress'
      elsif @assignment.complete?
        wrapper_class = 'assignment-complete'
      end
    %>
    <div class="assignment-summary-wrapper <%= wrapper_class %>">
      <section>
        <div class="assignment-date">
          <p><%= @assignment.assignment_definition.start_date.strftime("%b %e") %>
            <% if @assignment.assignment_definition.end_date != nil %>
              -
              <%= @assignment.assignment_definition.end_date.strftime("%b %e") %></p>
            <% end %>
        </div>
      </section>
    </div>
  </div>


  <% if @task %>
    <div class="task-container">

    <h3><%= @task.task_definition.name.html_safe %></h3>

    <% if @task.task_definition.summary %>
      <h4>Task to-do::</h4>
      <%= @task.task_definition.summary.html_safe %>
    <% end %>

    <% if @current_user.is_coach? %>
      <%= render "tasks/action_box_coach" %>
    <% else %>
      <%= render "tasks/action_box_student" %>
    <% end %>
  </div>

    <div class="task-discussion">
      <h4>Task Discussion</h4>
      <% if @current_user.is_coach? %>
        <p>Here, you can communicate with your student.</p>
      <% else %>
        <p>Here, you can communicate with your coach. Ask for help or comment here.</p>
      <% end %>

      <% @task.comments.each do |comment| %>
        <%= render partial: "comments/comment", locals: { :comment => comment } %>
      <% end %>
      <%= render partial: "comments/form", locals: { :task => @task } %>
    </div>

  <% else %>
    <% if @assignment.submittable? %>
      <%= link_to 'Submit Assignment', assignment_path(@assignment.id, submit: true), method: :patch, :class => 'btn-assignment-right' %>
    <% else %>
      This assignment is pending feedback, please wait for the coach.
    <% end %>
  <% end %>


  <div class="task-navigation-buttons">
    <% if @previous_task %>
      <a class="previous-task" href="/assignments/<%=@previous_task.assignment.id%>/tasks/<%= @previous_task.id %>">Previous</a>
    <% end %>
    <% if @next_task %>
      <a class="next-task" href="/assignments/<%=@next_task.assignment.id%>/tasks/<%= @next_task.id %>">Next</a>
    <% end %>
  </div>
</div>
